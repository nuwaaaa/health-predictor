# 体調予測アプリ — 要件定義書

> **プロジェクト名**: Health Predictor
> **作成日**: 2026-02-10
> **ステータス**: MVP開発中

-----

## 1. プロジェクト概要

日々の生活データ（体調・睡眠・歩数・ストレス）を記録し、個人専用の機械学習モデルで**今日の体調低下リスクを予測する**モバイルアプリ。

### 背景・課題

体調の波は多くの人が経験するが、事前に気づくのは難しい。特に睡眠不足や疲労の蓄積による体調悪化は、前日までのデータに兆候が現れることが多い。本アプリはその兆候を機械学習で検出し、ユーザーの行動調整を支援する。

### ターゲットユーザー

- 体調の波に悩んでいる人
- コンディション管理をしたい人
- 日々の体調を記録・振り返りたい人

-----

## 2. 機能要件

### 2.1 データ入力

|項目          |必須/任意|入力方法             |
|------------|-----|-----------------|
|体調スコア（1〜5段階）|必須   |顔アイコン1タップ        |
|睡眠（就寝・起床時刻） |必須   |時刻ピッカー → 睡眠時間自動計算|
|歩数          |必須   |手入力（将来はヘルスキット連携） |
|ストレス（1〜5段階） |任意   |数値タップ            |

### 2.2 予測機能

|機能      |開放条件             |出力            |
|--------|-----------------|--------------|
|今日の不調リスク|体調入力14日以上        |不調確率（%）       |
|3日間リスク  |60日以上 AND 不調10件以上|72時間以内の不調確率（%）|

- 個人のデータのみで学習する専用モデル
- 毎日深夜にバッチ学習・予測を自動実行
- 信頼度を3段階（低・中・高）で表示

### 2.3 データ可視化

- 直近7日間の体調推移グラフ
- 直近7日間の記録一覧（体調・睡眠・歩数）
- 学習進捗ステータス表示

### 2.4 段階的開放

データの蓄積量に応じて機能を段階的に開放し、精度が不十分な予測をユーザーに見せない設計。

|フェーズ    |条件               |表示内容       |
|--------|-----------------|-----------|
|データ収集中  |14日未満            |「学習中（あと○日）」|
|今日のリスク開放|14日以上            |不調確率を表示    |
|3日リスク開放 |60日以上 AND 不調10件以上|3日リスクを追加表示 |

-----

## 3. 非機能要件

|項目    |要件                           |
|------|-----------------------------|
|対応OS  |iOS / Android                |
|入力所要時間|1日あたり30秒以内                   |
|予測更新  |毎日 03:30 JST にバッチ実行          |
|データ保存 |Firebase Firestore（リアルタイム同期） |
|認証    |MVP段階は固定UID、将来Firebase Auth導入|

-----

## 4. 技術スタック

|レイヤー   |技術                      |
|-------|------------------------|
|フロントエンド|Flutter（Dart）           |
|データベース |Firebase Firestore      |
|バッチ処理  |Cloud Run（Python）       |
|初期モデル  |ロジスティック回帰（scikit-learn） |
|拡張モデル  |LightGBM（条件達成後、AUCで自動比較）|

-----

## 5. ML設計のポイント

### 特徴量

ユーザーの入力負担を増やさず、既存データからの**派生特徴量**で予測力を確保する。

- 体調の時系列: 前日スコア、3日/7日移動平均、前日差分、14日平均偏差
- 生活データ: 睡眠時間、歩数（前日値）、睡眠/歩数の偏差
- カレンダー: 曜日、休日フラグ
- リーク防止: 当日(t)の体調は予測入力に使わない（t-1以前のみ）

### 不調の定義

- 過去14日の体調平均より**1段階以上低い日**を不調と定義
- 個人の「普段の体調」を基準にするため、ユーザーごとに閾値が異なる

### モデル選択

- 60日未満: ロジスティック回帰のみ
- 60日以上: ロジスティック回帰とLightGBMを両方学習し、検証AUCが高い方を自動採用
- 少量データではシンプルなモデルの方が安定するケースが多いため、自動比較方式を採用

-----

## 6. 画面構成

```
ホーム画面
├── 体調入力（顔アイコン5段階）
├── 今日の記録サマリー → タップで詳細入力画面へ
│   ├── 睡眠（時刻ピッカー）
│   ├── 歩数（手入力）
│   └── ストレス（任意）
├── 学習ステータスバナー
├── 直近7日グラフ
└── 直近7日一覧
```

-----

## 7. 将来の拡張候補

- ウェアラブル連携（Apple Health / Google Fit）による自動データ取得
- 7日間予測
- 週次/月次レポート
- 詳細分析ダッシュボード
- 共通モデル＋個人差分によるスケール対応